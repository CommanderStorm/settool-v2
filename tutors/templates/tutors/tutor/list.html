{% extends "tutors/base_tutors.html" %}
{% load i18n %}
{% load bootstrap4 %}
{% load task_extras %}

{% block head %}
<script>
        $(document).ready(() => {
            $('#tutorTable').DataTable();
        });
    </script>
{% endblock %}

{% block set_common_headercontent %}{% trans "List tutors" %}{% endblock %}

{% block set_common_content %}
<div class="row">
    <div class="col-sm p-1">
        <a
            class="btn btn-secondary btn-block"
            href="{% if status == "all" %}{% url "tutor_export" "pdf" %}{% else %}{% url "tutor_export_status" "pdf" status %}{% endif %}"
        >{% trans "Export PDF" %} <span class="bi bi-file-earmark-person-fill"></span></a>
    </div>
    <div class="col-sm p-1">
        <a
            class="btn btn-secondary btn-block"
            href="{% if status == "all" %}{% url "tutor_export" "csv" %}{% else %}{% url "tutor_export_status" "csv" status %}{% endif %}"
        >{% trans "Export CSV" %} <span class="bi bi-file-spreadsheet"></span></a>
    </div>
    {% if status == "accepted" or status == "employee" %}
    <div class="col-sm p-1">
        <a
            class="btn btn-secondary btn-block"
            href="{% url "tutor_export_status" "tshirt" status %}"
        >{% trans "T-Shirt List" %} <span class="bi bi-person-lines-fill"></span></a>
    </div>
    {% endif %}
    {% if status != "all" %}
    <div class="col-sm p-1">
        <a
            class="btn btn-warning btn-block"
            href="{% url "tutor_mail_status" status %}"
        >{% trans "Send email" %}</a>
    </div>
    {% endif %}
    {% if status == "active" %}
    <div class="col-sm p-1">
        <a
            class="btn btn-danger btn-block"
            href="{% url "tutor_batch_accept" %}"
        >{% trans "Batch Accept" %}</a>
    </div>
    <div class="col-sm p-1">
        <a
            class="btn btn-danger btn-block"
            href="{% url "tutor_batch_decline" %}"
        >{% trans "Batch Decline" %}</a>
    </div>
    {% endif %}
</div>
<hr>
{% if status == "active" %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>#</th>
                <th>{% trans "Question" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for q in questions %}
            <tr>
                <td>Q{{ forloop.counter }}</td>
                <td>{% trans q.question %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<div class="table-responsive">
    <table
        id="tutorTable"
        class="table dataTable"
    >
        <thead>
            <tr>
                <th>#</th>
                <th>{% trans "First name" %}</th>
                <th>{% trans "Last name" %}</th>
                <th>{% trans "Subject" %}</th>
                <th>{% trans "|Subject| / |Subject-Wanted|" %}</th>
                {% if status == "accepted" %}
                <th>{% trans "Tasks Assigned" %}</th>
                {% endif %}
                {% if status == "all" %}
                <th>{% trans "Status" %}</th>
                {% endif %}
                <th>{% trans "Registration time" %}</th>
                {% if status == "active" %}
                {% for q in questions %}
                <th>Q{{ forloop.counter }}</th>
                {% endfor %}
                {% endif %}
                <th>{% trans "Actions" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for tutor in tutors %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td><a href="{% url "tutor_view" tutor.id %}">{{ tutor.first_name }}</a></td>
                <td><a href="{% url "tutor_view" tutor.id %}">{{ tutor.last_name }}</a></td>
                <td>{{ tutor.subject }}</td>
                <td>
                    {% with subject_info=tutor.subject.subjecttutorcountassignment_set.first accepted=tutor.subject.tutor_set|are_accepted %}
                    {{ accepted.count|default:0 }} / {{ subject_info.wanted|default:0 }}
                    {% endwith %}
                </td>
                {% if status == "accepted" %}
                <td>{{ tutor.task_set.count }}</td>
                {% endif %}
                {% if status == "all" %}
                <td>{% trans tutor.status %}</td>
                {% endif %}
                <td data-text="{{ tutor.registration_time|date:"Y-m-d H:i" }}">{{ tutor.registration_time }}</td>
                {% if status == "active" %}
                {% with q_c=questions|length answers=tutor.answer_set.all %}
                {% with t_c=answers.count %}
                {% for q in answers %}
                <td class="{% if q.answer == "YES" %}table-success{% elif q.answer == "NO" %}table-danger{% else %}table-warning{% endif %}">
                    {% if q.answer %}{% trans q.answer %}{% else %}-{% endif %}
                </td>
                {% endfor %}
                {% for i in q_c|subtract:t_c|times %}
                <td>-</td>
                {% endfor %}
                {% endwith %}
                {% endwith %}
                {% endif %}
                <td>
                    <a href="{% url "tutor_edit" tutor.id %}"><span class="bi bi-pencil-square"></span></a>
                    <a href="{% url "tutor_delete" tutor.id %}"><span class="bi bi-trash-fill"></span></a>
                    <a href="{% url "tutor_mail_tutor" tutor.id %}"><span class="bi bi-envelope-fill"></span></a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
