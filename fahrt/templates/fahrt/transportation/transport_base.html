{% load static %}
{% load task_extras %}
{% load i18n %}
{% load bootstrap4 %}

{% for transport_name_pl,transport_name, transport_type in transport_types %}
<h2 class='card-title'>{{ transport_name_pl }}</h2>
<div class="container-fluid mb-3">
    <div class="row flex-row flex-nowrap overflow-auto">
        {% for transport in transport_type %}
        <div
            class="card card-block"
            style='min-width: 30rem'
        >
            <div class='card-header'>{{ transport_name }} {{ forloop.counter }}</div>
            <div
                class='card-body'
                style='padding: 1rem'
            >
                <div class='table-responsive'>
                    <table class='table table-hover table-borderless'>
                        <tbody>
                            <tr>
                                <th>{% trans "Organisor/Driver:" %}</th>
                                <td>
                                    {% if transport.creator %}
                                    {% if transport.creator.publish_contact_to_other_paricipants or user.is_authenticated %}
                                    {{ transport.creator }}
                                    {% else %}
                                    {% trans "Hidden" %}
                                    {% endif %}
                                    {% else %}
                                    {% trans "[Deleted]" %}
                                    {% endif %}

                                    {% if user.is_authenticated and transport.creator %}
                                    <a href='{% url "fahrt_transport_edit_participant" transport.creator.uuid %}'><span class='bi bi-pencil'></span></a>
                                    <a href='{% url "fahrt_transport_del_participant" transport.creator.uuid %}'><span class='bi bi-trash'></span></a>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th>{% trans "Contact:" %}</th>
                                <td>
                                    {% if transport.creator %}
                                    {% if transport.creator.publish_contact_to_other_paricipants or user.is_authenticated %}
                                    {{ transport.creator.mobile|default_if_none:transport.creator.phone|default_if_none:transport.creator.email }}
                                    {% else %}
                                    {% trans "Hidden" %}
                                    {% endif %}
                                    {% else %}
                                    {% trans "[Deleted]" %}
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th>{% trans "Meeting-Place:" %}</th>
                                <td>{{ transport.deparure_place|default:"n.A." }}</td>
                            </tr>
                            <tr>
                                <th>{% trans "Departure:" %}</th>
                                <td>{{ transport.deparure_time|default:"n.A." }}</td>
                            </tr>
                            <tr>
                                <th>{% trans "Departure for return:" %}</th>
                                <td>{{ transport.return_departure_time|default:"n.A." }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                {% if transport.places > 1 %}
                <div class='table-responsive'>
                    <table class='table table-hover'>
                        <thead>
                            <tr>
                                {% if not user.is_authenticated %}
                                <th>#</th>
                                {% endif %}
                                <th>{% trans "Name" %}</th>
                                <th>{% trans "Contact" %}</th>
                                {% if user.is_authenticated %}
                                <th><span class='bi bi-lightning'></span></th>
                                {% endif %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for participant in transport.participant_set.all %}
                            {% if participant.uuid != transport.creator.uuid %}
                            <tr>
                                {% if not user.is_authenticated %}
                                <td>{{ forloop.counter }}</td>
                                {% endif %}
                                <td>
                                    {% if participant %}
                                    {% if user.is_authenticated %}
                                    <a href='{% url "fahrt_viewparticipant" participant.id %}'>{{ participant }}</a>
                                    {% elif participant.publish_contact_to_other_paricipants %}
                                    {{ participant }}
                                    {% else %}
                                    {% trans "Hidden" %}
                                    {% endif %}
                                    {% else %}
                                    {% trans "[Deleted]" %}
                                    {% endif %}
                                </td>
                                <td>
                                    {% if participant %}
                                    {% if participant.publish_contact_to_other_paricipants or user.is_authenticated %}
                                    {{ participant.mobile|default_if_none:participant.phone|default_if_none:participant.email }}
                                    {% else %}
                                    {% trans "Hidden" %}
                                    {% endif %}
                                    {% else %}
                                    {% trans "[Deleted]" %}
                                    {% endif %}
                                </td>
                                {% if user.is_authenticated %}
                                <td>
                                    <a href='{% url "fahrt_transport_edit_participant" participant.uuid %}'><span class='bi bi-pencil'></span></a>
                                    <a href='{% url "fahrt_transport_del_participant" participant.uuid %}'><span class='bi bi-trash'></span></a>
                                </td>
                                {% endif %}
                            </tr>
                            {% endif %}
                            {% endfor %}
                            {% for _ in transport.places|subtract:transport.participant_set.count|subtract:1|times %}
                            <tr>
                                {% if not user.is_authenticated %}
                                <td class='table-info'></td>{% endif %}
                                <td class='table-info'><a href='{% url "fahrt_transport_management_add_participant" transport.id %}'><span class='bi bi-plus'></span></a></td>
                                <td class='table-info'><a href='{% url "fahrt_transport_management_add_participant" transport.id %}'><span class='bi bi-plus'></span></a></td>
                                {% if user.is_authenticated %}
                                <td class='table-info'></td>{% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div>
        </div>
        {% if forloop.last %}
        <div
            class="card card-block"
            style='min-width: 30rem'
        >
            <div class='card-header'>
                {% blocktrans trimmed with transport_name=transport_name %}
                Add {{ transport_name }}
                {% endblocktrans %}
            </div>
            <a href='{% url "fahrt_transport_management_add_transport" transport.transport_type %}'>
                <div class='card-body text-center flex align-content-center '>
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20rem"
                        viewBox="0 0 16 16"
                    >
                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path>
                    </svg>
                </div>
            </a>
        </div>
        {% endif %}
        {% endfor %}
    </div>
</div>
{% endfor %}
